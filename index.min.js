var Template,Alchemist,Nudist;Nudist=function(e){"use strict";function t(e){this.expose(e)}var n,i;return i=t,n=t.prototype,i.className="Nudist",n.expose=function(e,t){"function"==typeof define&&define(e.name.toLowerCase(),[],function(){return e}),"undefined"!=typeof module&&(module.exports=e),"undefined"!=typeof window&&(window[e.name]=e),"undefined"!=typeof global&&(global[e.name]=e),"undefined"!=typeof t&&(t[e.name]=e)},n.toString=function(){return"[object "+this.name+"]"},t}(this),Alchemist=function(e){"use strict";function t(e){this.setElement(e)}var n,i,r;return i=t,n=t.prototype,i.className="Alchemist",r={},r.invalidElement="Invalid or unknown element was specified.",r.invalidElement=new Error(r.invalidElement),n.asElement=function(e){return e.constructor===String&&(e=document.querySelector(e)),"undefined"!=typeof jQuery&&e.constructor===jQuery&&(e=e.get(0)),e instanceof Element&&"TEMPLATE"===e.tagName&&(e=e.content),e instanceof DocumentFragment&&e.hasChildNodes()&&(e=e.firstElementChild),e instanceof Element?e:r.invalidElement},n.setElement=function(e){return this.element=this.asElement(e),this.element},n.getElement=function(){return this.element},n.toString=function(){return"[object "+this.name+"]"},t}(),Template=function(e){"use strict";function t(e,t){var n,i,r;return n=/[.{}]/g,i=function(e){return e},r=function(e,t){return e[t]},t.split(n).filter(i).reduce(r,e)}function n(e){return!!e}function i(e){this.initialize(),this.setElement(e)}var r,o;return o=i,r=i.prototype,o.className="Template",r.setElement=function(e){return"undefined"!=typeof Alchemist&&(e=Alchemist.prototype.asElement(e)),this.element=e,e},r.compile=function(e,n){var i,r;return i=/\{([^}]+)\}/g,r=function(e,i){return t(n,i)},e=e.trim(),e=e.replace(i,r)},r.crawl=function(e,t){var n,i,r,o;return r=this,o=arguments,n=function(e){var n,i;return i=function(n){var i;e.hasAttribute(n.name)&&(i=r.compile(n.value,t),e.setAttribute(n.name,i))},n=[].slice.call(e.attributes,0),n.map(i)},i=function(){var n,i,o,s,u=document.TEXT_NODE,c=document.ELEMENT_NODE;return n=function(t,n,i){e.childNodes[n]=r.crawl(t,i)},i=function(t,n,i){var o;o=r.compile(t.textContent,i),e.childNodes[n].textContent=o},s=function(e,r){e.nodeType===u&&i(e,r,t),e.nodeType===c&&n(e,r,t)},o=[].slice.call(e.childNodes,0),o.map(s)},e.hasAttributes()&&n(e,t),e.hasChildNodes()&&i(e,t),e},r.prepare=function(e){var t,i,r,o,s;return n(e)?(t=this.element.cloneNode(!0),o=this.crawl(t,e),i=t.innerHTML,r=/\{([^}]+)\}/g,this.appendSources(e),s=btoa(JSON.stringify(e)),t.template=this,t.rendered=s,t):void 0},r.render=function(){return this.sources.map(function(e){this.pipeline.reduce(function(e,t){return"function"==typeof t?t(e):"undefined"!=typeof t.childNodes?function(e,n){for(var i=0;i<n.length;i++)if("undefined"!=typeof n[i].rendered&&n[i].rendered===e.rendered)return t.replaceChild(e,n[i]);return t.appendChild(e),e}.call(this,this.prepare(e),t.childNodes):t(e)}.bind(this),e)}.bind(this)),this.sources=[],this},r.appendSources=function(e){return e.constructor===Array?e.map(this.appendSources):(this.sources.push(e),e)},r.pipe=function(e){var t;switch(t=this.pipeline.indexOf(e),typeof e){case"undefined":return!1;case"function":break;case"object":return this.appendSources(e),this;default:e=i.prototype.setElement(e)}return-1!==t?this.pipeline.splice(t,1,e):this.pipeline.push(e),this.render(),this},r.initialize=function(){this.pipeline=[],this.sources=[]},r.toString=function(){return"[object "+this.name+"]"},i}(),new Nudist(Template);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0ZW1wbGF0ZS5qcyJdLCJuYW1lcyI6WyJUZW1wbGF0ZSIsIkFsY2hlbWlzdCIsIk51ZGlzdCIsInNjb3BlIiwicHJvZ3JhbSIsInRoaXMiLCJleHBvc2UiLCJwcm90b3R5cGUiLCJjb25zdHJ1Y3RvciIsImNsYXNzTmFtZSIsImlucHV0IiwiZGVmaW5lIiwibmFtZSIsInRvTG93ZXJDYXNlIiwibW9kdWxlIiwiZXhwb3J0cyIsIndpbmRvdyIsImdsb2JhbCIsInRvU3RyaW5nIiwiZWxlbWVudCIsInNldEVsZW1lbnQiLCJlcnJvciIsImludmFsaWRFbGVtZW50IiwiRXJyb3IiLCJhc0VsZW1lbnQiLCJTdHJpbmciLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJqUXVlcnkiLCJnZXQiLCJFbGVtZW50IiwidGFnTmFtZSIsImNvbnRlbnQiLCJEb2N1bWVudEZyYWdtZW50IiwiaGFzQ2hpbGROb2RlcyIsImZpcnN0RWxlbWVudENoaWxkIiwiZ2V0RWxlbWVudCIsInF1ZXJ5Iiwib2JqZWN0IiwicHJvcGVydHkiLCJyZWdleCIsImZpbHRlciIsInJlZHVjZSIsInNvdXJjZSIsImtleSIsInNwbGl0IiwidmFsaWRhdGUiLCJkYXRhIiwiaW5pdGlhbGl6ZSIsImNvbXBpbGUiLCJ2YWx1ZSIsInJlcGxhY2VtZW50Iiwib3JpZ2luYWwiLCJ0cmltIiwicmVwbGFjZSIsImNyYXdsIiwiZG9BdHRyaWJ1dGVzIiwiZG9DaGlsZHJlbiIsInNlbGYiLCJhcmdzIiwiYXJndW1lbnRzIiwiYXR0cmlidXRlcyIsImxvb3AiLCJhdHRyaWJ1dGUiLCJjb21waWxlZCIsImhhc0F0dHJpYnV0ZSIsInNldEF0dHJpYnV0ZSIsInNsaWNlIiwiY2FsbCIsIm1hcCIsInNldFRleHROb2RlIiwiY2hpbGRyZW4iLCJ0ZXh0Tm9kZSIsIlRFWFRfTk9ERSIsImVsZW1lbnROb2RlIiwiRUxFTUVOVF9OT0RFIiwiY2hpbGQiLCJpIiwiY2hpbGROb2RlcyIsInRleHRDb250ZW50Iiwibm9kZVR5cGUiLCJoYXNBdHRyaWJ1dGVzIiwicHJlcGFyZSIsImh0bWwiLCJwcm9wZXJ0aWVzIiwicmVzb2x2ZSIsImNsb25lTm9kZSIsImlubmVySFRNTCIsImFwcGVuZFNvdXJjZXMiLCJidG9hIiwiSlNPTiIsInN0cmluZ2lmeSIsInRlbXBsYXRlIiwicmVuZGVyZWQiLCJyZW5kZXIiLCJzb3VyY2VzIiwicGlwZWxpbmUiLCJwcmV2aW91cyIsImN1cnJlbnQiLCJwcmVwYXJlZCIsImxlbmd0aCIsInJlcGxhY2VDaGlsZCIsImFwcGVuZENoaWxkIiwiYmluZCIsIkFycmF5IiwicHVzaCIsInBpcGUiLCJmbG93IiwiaW5kZXgiLCJpbmRleE9mIiwic3BsaWNlIl0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxVQUNBQyxVQUNBQyxNQUVBQSxRQUFBLFNBQUFDLEdBQ0EsWUFvQ0EsU0FBQUQsR0FBQUUsR0FDQUMsS0FBQUMsT0FBQUYsR0FuQ0EsR0FBQUcsR0FDQUMsQ0FxQ0EsT0FuQ0FBLEdBQUFOLEVBQ0FLLEVBQUFMLEVBQUFLLFVBRUFDLEVBQUFDLFVBQUEsU0FFQUYsRUFBQUQsT0FBQSxTQUFBSSxFQUFBUCxHQUNBLGtCQUFBUSxTQUNBQSxPQUFBRCxFQUFBRSxLQUFBQyxpQkFBQSxXQUFBLE1BQUFILEtBR0EsbUJBQUFJLFVBQ0FBLE9BQUFDLFFBQUFMLEdBR0EsbUJBQUFNLFVBQ0FBLE9BQUFOLEVBQUFFLE1BQUFGLEdBR0EsbUJBQUFPLFVBQ0FBLE9BQUFQLEVBQUFFLE1BQUFGLEdBR0EsbUJBQUFQLEtBQ0FBLEVBQUFPLEVBQUFFLE1BQUFGLElBSUFILEVBQUFXLFNBQUEsV0FDQSxNQUFBLFdBQUFiLEtBQUFPLEtBQUEsS0FPQVYsR0FDQUcsTUFFQUosVUFBQSxTQUFBa0IsR0FDQSxZQTJEQSxTQUFBbEIsR0FBQWtCLEdBQ0FkLEtBQUFlLFdBQUFELEdBMURBLEdBQUFaLEdBQ0FDLEVBRUFhLENBMERBLE9BeERBYixHQUFBUCxFQUNBTSxFQUFBTixFQUFBTSxVQUVBQyxFQUFBQyxVQUFBLFlBRUFZ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LGNBQUFnRyxNQUNBbEUsRUFBQStCLElBQUFoRSxLQUFBbUYsZ0JBR0FuRixLQUFBMEYsUUFBQVUsS0FBQW5FLEdBRUFBLElBR0EvQixFQUFBbUcsS0FBQSxTQUFBQyxHQUVBLEdBQUFDLEVBSUEsUUFGQUEsRUFBQXZHLEtBQUEyRixTQUFBYSxRQUFBRixTQUVBQSxJQUNBLElBQUEsWUFDQSxPQUFBLENBQ0EsS0FBQSxXQUNBLEtBQ0EsS0FBQSxTQUVBLE1BREF0RyxNQUFBbUYsY0FBQW1CLEdBQ0F0RyxJQUNBLFNBQ0FzRyxFQUFBM0csRUFBQU8sVUFBQWEsV0FBQXVGLEdBV0EsTUFSQSxLQUFBQyxFQUNBdkcsS0FBQTJGLFNBQUFjLE9BQUFGLEVBQUEsRUFBQUQsR0FFQXRHLEtBQUEyRixTQUFBUyxLQUFBRSxHQUdBdEcsS0FBQXlGLFNBRUF6RixNQUdBRSxFQUFBeUMsV0FBQSxXQUNBM0MsS0FBQTJGLFlBQ0EzRixLQUFBMEYsWUFHQXhGLEVBQUFXLFNBQUEsV0FDQSxNQUFBLFdBQUFiLEtBQUFPLEtBQUEsS0FRQVosS0FHQSxHQUFBRSxRQUFBRiIsImZpbGUiOiJpbmRleC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgVGVtcGxhdGU7XHJcbnZhciBBbGNoZW1pc3Q7XHJcbnZhciBOdWRpc3Q7XHJcblxyXG5OdWRpc3QgPSAoZnVuY3Rpb24oc2NvcGUpIHtcclxuICAndXNlIHN0cmljdCc7XHJcblxyXG4gIHZhciBwcm90b3R5cGU7XHJcbiAgdmFyIGNvbnN0cnVjdG9yO1xyXG5cclxuICBjb25zdHJ1Y3RvciA9IE51ZGlzdDtcclxuICBwcm90b3R5cGUgPSBOdWRpc3QucHJvdG90eXBlO1xyXG5cclxuICBjb25zdHJ1Y3Rvci5jbGFzc05hbWUgPSAnTnVkaXN0JztcclxuXHJcbiAgcHJvdG90eXBlLmV4cG9zZSA9IGZ1bmN0aW9uIGV4cG9zZShpbnB1dCwgc2NvcGUpIHtcclxuICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIGRlZmluZShpbnB1dC5uYW1lLnRvTG93ZXJDYXNlKCksIFtdLCBmdW5jdGlvbiAoKSB7IHJldHVybiBpbnB1dDsgfSApO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICBtb2R1bGUuZXhwb3J0cyA9IGlucHV0O1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICB3aW5kb3dbaW5wdXQubmFtZV0gPSBpbnB1dDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgZ2xvYmFsW2lucHV0Lm5hbWVdID0gaW5wdXQ7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHR5cGVvZiBzY29wZSAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgc2NvcGVbaW5wdXQubmFtZV0gPSBpbnB1dDtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBwcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiB0b1N0cmluZygpIHtcclxuICAgIHJldHVybiAnW29iamVjdCAnICsgdGhpcy5uYW1lICsgJ10nXHJcbiAgfTtcclxuXHJcbiAgZnVuY3Rpb24gTnVkaXN0KHByb2dyYW0pIHtcclxuICAgIHRoaXMuZXhwb3NlKHByb2dyYW0pO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIE51ZGlzdDtcclxufSh0aGlzKSk7XHJcblxyXG5BbGNoZW1pc3QgPSAoZnVuY3Rpb24oZWxlbWVudCkge1xyXG4gICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgdmFyIHByb3RvdHlwZTtcclxuICB2YXIgY29uc3RydWN0b3I7XHJcblxyXG4gIHZhciBlcnJvcjtcclxuXHJcbiAgY29uc3RydWN0b3IgPSBBbGNoZW1pc3Q7XHJcbiAgcHJvdG90eXBlID0gQWxjaGVtaXN0LnByb3RvdHlwZTtcclxuXHJcbiAgY29uc3RydWN0b3IuY2xhc3NOYW1lID0gXCJBbGNoZW1pc3RcIjtcclxuXHJcbiAgZXJyb3IgPSB7fTtcclxuICBlcnJvci5pbnZhbGlkRWxlbWVudCA9IFwiSW52YWxpZCBvciB1bmtub3duIGVsZW1lbnQgd2FzIHNwZWNpZmllZC5cIjtcclxuICBlcnJvci5pbnZhbGlkRWxlbWVudCA9IG5ldyBFcnJvcihlcnJvci5pbnZhbGlkRWxlbWVudCk7XHJcblxyXG4gIHByb3RvdHlwZS5hc0VsZW1lbnQgPSBmdW5jdGlvbiBhc0VsZW1lbnQoZWxlbWVudCkge1xyXG4gICAgLy8gZmluZCBzcGVjaWZpZWQgZWxlbWVudFxyXG4gICAgaWYgKGVsZW1lbnQuY29uc3RydWN0b3IgPT09IFN0cmluZykge1xyXG4gICAgICBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihlbGVtZW50KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBpdCdzIGEgalF1ZXJ5IG5vZGVcclxuICAgIGlmICh0eXBlb2YgalF1ZXJ5ICE9PSAndW5kZWZpbmVkJyAmJiBlbGVtZW50LmNvbnN0cnVjdG9yID09PSBqUXVlcnkpIHtcclxuICAgICAgZWxlbWVudCA9IGVsZW1lbnQuZ2V0KDApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGh0bWw1IHRlbXBsYXRlIGNvbnRlbnRcclxuICAgIGlmIChlbGVtZW50IGluc3RhbmNlb2YgRWxlbWVudCAmJiBlbGVtZW50LnRhZ05hbWUgPT09ICdURU1QTEFURScpIHtcclxuICAgICAgZWxlbWVudCA9IGVsZW1lbnQuY29udGVudDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBkZWZyYWdtZW50XHJcbiAgICBpZiAoZWxlbWVudCBpbnN0YW5jZW9mIERvY3VtZW50RnJhZ21lbnQgJiYgZWxlbWVudC5oYXNDaGlsZE5vZGVzKCkpIHtcclxuICAgICAgZWxlbWVudCA9IGVsZW1lbnQuZmlyc3RFbGVtZW50Q2hpbGQ7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gZWxlbWVudCBpcyBhbHJlYWR5IHByb3ZpZGVkXHJcbiAgICBpZiAoZWxlbWVudCBpbnN0YW5jZW9mIEVsZW1lbnQpIHtcclxuICAgICAgcmV0dXJuIGVsZW1lbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGVycm9yLmludmFsaWRFbGVtZW50O1xyXG4gIH07XHJcblxyXG4gIHByb3RvdHlwZS5zZXRFbGVtZW50ID0gZnVuY3Rpb24gc2V0RWxlbWVudChlbGVtZW50KSB7XHJcbiAgICB0aGlzLmVsZW1lbnQgPSB0aGlzLmFzRWxlbWVudChlbGVtZW50KTtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5lbGVtZW50O1xyXG4gIH07XHJcblxyXG4gIHByb3RvdHlwZS5nZXRFbGVtZW50ID0gZnVuY3Rpb24gZ2V0RWxlbWVudCgpIHtcclxuICAgIHJldHVybiB0aGlzLmVsZW1lbnQ7XHJcbiAgfTtcclxuXHJcbiAgcHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gdG9TdHJpbmcoKSB7XHJcbiAgICByZXR1cm4gJ1tvYmplY3QgJyArIHRoaXMubmFtZSArICddJztcclxuICB9O1xyXG5cclxuICBmdW5jdGlvbiBBbGNoZW1pc3QoZWxlbWVudCkge1xyXG4gICAgdGhpcy5zZXRFbGVtZW50KGVsZW1lbnQpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIEFsY2hlbWlzdDtcclxufSgpKTtcclxuXHJcblRlbXBsYXRlID0gKGZ1bmN0aW9uKGVsZW1lbnQpIHtcclxuICAndXNlIHN0cmljdCc7XHJcblxyXG4gIHZhciBwcm90b3R5cGU7XHJcbiAgdmFyIGNvbnN0cnVjdG9yO1xyXG5cclxuICBjb25zdHJ1Y3RvciA9IFRlbXBsYXRlO1xyXG4gIHByb3RvdHlwZSA9IFRlbXBsYXRlLnByb3RvdHlwZTtcclxuXHJcbiAgY29uc3RydWN0b3IuY2xhc3NOYW1lID0gXCJUZW1wbGF0ZVwiO1xyXG5cclxuICBmdW5jdGlvbiBxdWVyeShvYmplY3QsIHByb3BlcnR5KSB7XHJcbiAgICB2YXIgcmVnZXg7XHJcbiAgICB2YXIgZmlsdGVyO1xyXG4gICAgdmFyIHJlZHVjZTtcclxuXHJcbiAgICByZWdleCA9IC9bLnt9XS9nO1xyXG4gICAgZmlsdGVyID0gZnVuY3Rpb24gZmlsdGVyKHNvdXJjZSkgeyByZXR1cm4gc291cmNlOyB9O1xyXG4gICAgcmVkdWNlID0gZnVuY3Rpb24gcmVkdWNlKHNvdXJjZSwga2V5KSB7IHJldHVybiBzb3VyY2Vba2V5XTsgfTtcclxuXHJcbiAgICByZXR1cm4gcHJvcGVydHlcclxuICAgIC5zcGxpdChyZWdleClcclxuICAgIC5maWx0ZXIoZmlsdGVyKVxyXG4gICAgLnJlZHVjZShyZWR1Y2UsIG9iamVjdCk7XHJcbiAgfVxyXG5cclxuICBwcm90b3R5cGUuc2V0RWxlbWVudCA9IGZ1bmN0aW9uIHNldEVsZW1lbnQoZWxlbWVudCkge1xyXG4gICAgaWYgKHR5cGVvZiBBbGNoZW1pc3QgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIGVsZW1lbnQgPSBBbGNoZW1pc3QucHJvdG90eXBlLmFzRWxlbWVudChlbGVtZW50KTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xyXG5cclxuICAgIHJldHVybiBlbGVtZW50O1xyXG4gIH07XHJcblxyXG4gIHByb3RvdHlwZS5jb21waWxlID0gZnVuY3Rpb24gY29tcGlsZSh2YWx1ZSwgZGF0YSkge1xyXG4gICAgdmFyIHJlZ2V4O1xyXG4gICAgdmFyIHJlcGxhY2VtZW50O1xyXG5cclxuICAgIHJlZ2V4ID0gL1xceyhbXn1dKylcXH0vZztcclxuXHJcbiAgICByZXBsYWNlbWVudCA9IGZ1bmN0aW9uIHJlcGxhY2VtZW50KG9yaWdpbmFsLCBwcm9wZXJ0eSkge1xyXG4gICAgICByZXR1cm4gcXVlcnkoZGF0YSwgcHJvcGVydHkpO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YWx1ZSA9IHZhbHVlLnRyaW0oKTtcclxuICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZShyZWdleCwgcmVwbGFjZW1lbnQpO1xyXG5cclxuICAgIHJldHVybiB2YWx1ZTtcclxuICB9O1xyXG5cclxuICBwcm90b3R5cGUuY3Jhd2wgPSBmdW5jdGlvbiBjcmF3bChlbGVtZW50LCBkYXRhKSB7XHJcbiAgICB2YXIgZG9BdHRyaWJ1dGVzO1xyXG4gICAgdmFyIGRvQ2hpbGRyZW47XHJcblxyXG4gICAgdmFyIHNlbGYsIGFyZ3M7XHJcblxyXG4gICAgc2VsZiA9IHRoaXM7XHJcbiAgICBhcmdzID0gYXJndW1lbnRzO1xyXG5cclxuICAgIGRvQXR0cmlidXRlcyA9IGZ1bmN0aW9uIGRvQXR0cmlidXRlcyhlbGVtZW50KSB7XHJcbiAgICAgIHZhciBhdHRyaWJ1dGVzO1xyXG4gICAgICB2YXIgYXR0cmlidXRlO1xyXG5cclxuICAgICAgdmFyIGxvb3A7XHJcblxyXG4gICAgICBsb29wID0gZnVuY3Rpb24gbG9vcChhdHRyaWJ1dGUpIHtcclxuICAgICAgICB2YXIgY29tcGlsZWQ7XHJcblxyXG4gICAgICAgIGlmIChlbGVtZW50Lmhhc0F0dHJpYnV0ZShhdHRyaWJ1dGUubmFtZSkpIHtcclxuICAgICAgICAgIGNvbXBpbGVkID0gc2VsZi5jb21waWxlKGF0dHJpYnV0ZS52YWx1ZSwgZGF0YSk7XHJcbiAgICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZShhdHRyaWJ1dGUubmFtZSwgY29tcGlsZWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIGF0dHJpYnV0ZXMgPSAoW10pLnNsaWNlLmNhbGwoZWxlbWVudC5hdHRyaWJ1dGVzLCAwKTtcclxuXHJcbiAgICAgIHJldHVybiBhdHRyaWJ1dGVzLm1hcChsb29wKTtcclxuICAgIH07XHJcblxyXG4gICAgZG9DaGlsZHJlbiA9IGZ1bmN0aW9uIGRvQ2hpbGRyZW4oKSB7XHJcbiAgICAgIHZhciB0ZXh0Tm9kZSA9IGRvY3VtZW50LlRFWFRfTk9ERTtcclxuICAgICAgdmFyIGVsZW1lbnROb2RlID0gZG9jdW1lbnQuRUxFTUVOVF9OT0RFO1xyXG5cclxuICAgICAgdmFyIHNldEVsZW1lbnQ7XHJcbiAgICAgIHZhciBzZXRUZXh0Tm9kZTtcclxuXHJcbiAgICAgIHZhciBjaGlsZHJlbjtcclxuICAgICAgdmFyIGNoaWxkO1xyXG5cclxuICAgICAgdmFyIGxvb3A7XHJcbiAgICAgIHZhciBmaXhFbGVtZW50O1xyXG4gICAgICB2YXIgZml4VGV4dE5vZGU7XHJcblxyXG4gICAgICBzZXRFbGVtZW50ID0gZnVuY3Rpb24gc2V0RWxlbWVudChjaGlsZCwgaSwgZGF0YSkge1xyXG4gICAgICAgIGVsZW1lbnQuY2hpbGROb2Rlc1tpXSA9IHNlbGYuY3Jhd2woY2hpbGQsIGRhdGEpO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgc2V0VGV4dE5vZGUgPSBmdW5jdGlvbiBzZXRUZXh0Tm9kZShjaGlsZCwgaSwgZGF0YSkge1xyXG4gICAgICAgIHZhciBjb21waWxlZDtcclxuXHJcbiAgICAgICAgY29tcGlsZWQgPSBzZWxmLmNvbXBpbGUoY2hpbGQudGV4dENvbnRlbnQsIGRhdGEpO1xyXG5cclxuICAgICAgICBlbGVtZW50LmNoaWxkTm9kZXNbaV0udGV4dENvbnRlbnQgPSBjb21waWxlZDtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGxvb3AgPSBmdW5jdGlvbiBsb29wKGNoaWxkLCBpKSB7XHJcbiAgICAgICAgaWYoY2hpbGQubm9kZVR5cGUgPT09IHRleHROb2RlKSB7XHJcbiAgICAgICAgICBzZXRUZXh0Tm9kZShjaGlsZCwgaSwgZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjaGlsZC5ub2RlVHlwZSA9PT0gZWxlbWVudE5vZGUpIHtcclxuICAgICAgICAgIHNldEVsZW1lbnQoY2hpbGQsIGksIGRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNoaWxkcmVuID0gKFtdKS5zbGljZS5jYWxsKGVsZW1lbnQuY2hpbGROb2RlcywgMCk7XHJcblxyXG4gICAgICByZXR1cm4gY2hpbGRyZW4ubWFwKGxvb3ApO1xyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoZWxlbWVudC5oYXNBdHRyaWJ1dGVzKCkpIHtcclxuICAgICAgZG9BdHRyaWJ1dGVzKGVsZW1lbnQsIGRhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChlbGVtZW50Lmhhc0NoaWxkTm9kZXMoKSkge1xyXG4gICAgICBkb0NoaWxkcmVuKGVsZW1lbnQsIGRhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBlbGVtZW50O1xyXG4gIH07XHJcblxyXG4gIGZ1bmN0aW9uIGhhc1Byb3BlcnRpZXMob2JqZWN0LCBhcnJheSkge1xyXG4gICAgdmFyIGFyZU1pc3Npbmc7XHJcblxyXG4gICAgYXJlTWlzc2luZyA9IGZ1bmN0aW9uIGFyZU1pc3NpbmcocHJvcGVydHkpIHtcclxuICAgICAgcmV0dXJuICFvYmplY3QuaGFzT3duUHJvcGVydHkocHJvcGVydHkpO1xyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gYXJyYXkuc29tZShhcmVNaXNzaW5nKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHZhbGlkYXRlKGRhdGEpIHtcclxuICAgIGlmICghZGF0YSkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIHByb3RvdHlwZS5wcmVwYXJlID0gZnVuY3Rpb24gcHJlcGFyZShkYXRhKSB7XHJcbiAgICB2YXIgZWxlbWVudDtcclxuICAgIHZhciBodG1sO1xyXG4gICAgdmFyIHByb3BlcnRpZXM7XHJcbiAgICB2YXIgcmVzb2x2ZTtcclxuICAgIHZhciBzb3VyY2U7XHJcblxyXG4gICAgaWYgKHZhbGlkYXRlKGRhdGEpKSB7XHJcblxyXG4gICAgICBlbGVtZW50ID0gdGhpcy5lbGVtZW50LmNsb25lTm9kZSh0cnVlKTtcclxuICAgICAgcmVzb2x2ZSA9IHRoaXMuY3Jhd2woZWxlbWVudCwgZGF0YSk7XHJcblxyXG4gICAgICBodG1sID0gZWxlbWVudC5pbm5lckhUTUw7XHJcblxyXG4gICAgICBwcm9wZXJ0aWVzID0gL1xceyhbXn1dKylcXH0vZztcclxuXHJcbiAgICAgIHRoaXMuYXBwZW5kU291cmNlcyhkYXRhKTtcclxuXHJcbiAgICAgIHNvdXJjZSA9IGJ0b2EoSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xyXG5cclxuICAgICAgZWxlbWVudC50ZW1wbGF0ZSA9IHRoaXM7XHJcbiAgICAgIGVsZW1lbnQucmVuZGVyZWQgPSBzb3VyY2U7XHJcblxyXG4gICAgICByZXR1cm4gZWxlbWVudDtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBwcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zb3VyY2VzLm1hcChmdW5jdGlvbihzb3VyY2UpIHtcclxuICAgICAgdGhpcy5waXBlbGluZS5yZWR1Y2UoZnVuY3Rpb24ocHJldmlvdXMsIGN1cnJlbnQpIHtcclxuICAgICAgICBpZiAodHlwZW9mIGN1cnJlbnQgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgIHJldHVybiBjdXJyZW50KHByZXZpb3VzKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBjdXJyZW50LmNoaWxkTm9kZXMgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICByZXR1cm4gKGZ1bmN0aW9uKHByZXBhcmVkLCBjaGlsZHJlbikge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjaGlsZHJlbltpXS5yZW5kZXJlZCAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjaGlsZHJlbltpXS5yZW5kZXJlZCA9PT0gcHJlcGFyZWQucmVuZGVyZWQpIHtcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnQucmVwbGFjZUNoaWxkKHByZXBhcmVkLCBjaGlsZHJlbltpXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGN1cnJlbnQuYXBwZW5kQ2hpbGQocHJlcGFyZWQpO1xyXG4gICAgICAgICAgICByZXR1cm4gcHJlcGFyZWQ7XHJcbiAgICAgICAgICB9LmNhbGwodGhpcywgdGhpcy5wcmVwYXJlKHByZXZpb3VzKSwgY3VycmVudC5jaGlsZE5vZGVzKSk7XHJcbiAgICAgICAgICAvL3JldHVybiBwcmV2aW91cztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGN1cnJlbnQocHJldmlvdXMpO1xyXG4gICAgICB9LmJpbmQodGhpcyksIHNvdXJjZSk7XHJcbiAgICB9LmJpbmQodGhpcykpO1xyXG4gICAgdGhpcy5zb3VyY2VzID0gW107XHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9O1xyXG5cclxuICBwcm90b3R5cGUuYXBwZW5kU291cmNlcyA9IGZ1bmN0aW9uKG9iamVjdCkge1xyXG4gICAgaWYgKG9iamVjdC5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHtcclxuICAgICAgcmV0dXJuIG9iamVjdC5tYXAodGhpcy5hcHBlbmRTb3VyY2VzKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnNvdXJjZXMucHVzaChvYmplY3QpO1xuXG4gICAgcmV0dXJuIG9iamVjdDtcclxuICB9O1xyXG5cclxuICBwcm90b3R5cGUucGlwZSA9IGZ1bmN0aW9uIHBpcGUoZmxvdykge1xyXG4gICAgLy8gcmVzb2x2ZSBkdXBsaWNhdGVzXHJcbiAgICB2YXIgaW5kZXg7XHJcblxyXG4gICAgaW5kZXggPSB0aGlzLnBpcGVsaW5lLmluZGV4T2YoZmxvdyk7XHJcblxyXG4gICAgc3dpdGNoKHR5cGVvZiBmbG93KSB7XHJcbiAgICAgIGNhc2UgJ3VuZGVmaW5lZCc6XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICBjYXNlICdmdW5jdGlvbic6XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ29iamVjdCc6XHJcbiAgICAgICAgdGhpcy5hcHBlbmRTb3VyY2VzKGZsb3cpXHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgZmxvdyA9IFRlbXBsYXRlLnByb3RvdHlwZS5zZXRFbGVtZW50KGZsb3cpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChpbmRleCAhPT0gLTEpIHtcclxuICAgICAgdGhpcy5waXBlbGluZS5zcGxpY2UoaW5kZXgsIDEsIGZsb3cpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5waXBlbGluZS5wdXNoKGZsb3cpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMucmVuZGVyKCk7XHJcblxyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfTtcclxuXHJcbiAgcHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiBpbml0aWFsaXplKCkge1xyXG4gICAgdGhpcy5waXBlbGluZSA9IFtdO1xyXG4gICAgdGhpcy5zb3VyY2VzID0gW107XHJcbiAgfTtcclxuXHJcbiAgcHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gdG9TdHJpbmcoKSB7XHJcbiAgICByZXR1cm4gJ1tvYmplY3QgJyArIHRoaXMubmFtZSArICddJztcclxuICB9O1xyXG5cclxuICBmdW5jdGlvbiBUZW1wbGF0ZShlbGVtZW50KSB7XHJcbiAgICB0aGlzLmluaXRpYWxpemUoKTtcclxuICAgIHRoaXMuc2V0RWxlbWVudChlbGVtZW50KTtcclxuICB9XHJcblxyXG4gIHJldHVybiBUZW1wbGF0ZTtcclxufSgpKTtcclxuXHJcbm5ldyBOdWRpc3QoVGVtcGxhdGUpO1xyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
